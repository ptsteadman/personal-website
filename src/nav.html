<html><head><title>How To Set Up and Use Dyanmics NAV Web Services.docx</title><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=wAPX1HepqA24RkYW1AuHYA');.lst-kix_list_1-3>li:before{content:"\0025aa  "}.lst-kix_list_1-1>li:before{content:"o  "}.lst-kix_list_1-6>li:before{content:"\0025aa  "}.lst-kix_list_1-2>li:before{content:"\0025aa  "}.lst-kix_list_1-5>li:before{content:"\0025aa  "}ul.lst-kix_list_1-0{list-style-type:none}ul.lst-kix_list_1-2{list-style-type:none}ul.lst-kix_list_1-1{list-style-type:none}ul.lst-kix_list_1-4{list-style-type:none}.lst-kix_list_1-7>li:before{content:"\0025aa  "}.lst-kix_list_1-0>li:before{content:"\0025cf  "}ul.lst-kix_list_1-3{list-style-type:none}ul.lst-kix_list_1-6{list-style-type:none}ul.lst-kix_list_1-5{list-style-type:none}ul.lst-kix_list_1-8{list-style-type:none}.lst-kix_list_1-8>li:before{content:"\0025aa  "}ul.lst-kix_list_1-7{list-style-type:none}.lst-kix_list_1-4>li:before{content:"\0025aa  "}ol{margin:0;padding:0}.c3{line-height:1.0;padding-top:0pt;widows:2;orphans:2;height:11pt;direction:ltr;padding-bottom:0pt}.c4{line-height:1.0;padding-top:0pt;widows:2;orphans:2;direction:ltr;padding-bottom:0pt}.c2{font-size:11pt;font-family:"Calibri";text-decoration:underline;font-weight:bold}.c0{font-size:11pt;font-family:"Calibri";font-weight:normal}.c6{font-size:9pt;font-family:"Courier New";font-weight:normal}.c8{widows:2;orphans:2;direction:ltr}.c5{font-size:11pt;font-family:"Calibri";font-weight:bold}.c11{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c12{font-size:11pt;font-family:"Courier New";font-weight:normal}.c9{color:#0000ff;text-decoration:underline}.c7{color:inherit;text-decoration:inherit}.c10{font-weight:bold}.c1{font-style:italic}.c13{height:11pt}.title{widows:2;padding-top:24pt;line-height:1.1500000000000001;orphans:2;text-align:left;color:#000000;font-size:36pt;font-family:"Calibri";font-weight:bold;padding-bottom:6pt;page-break-after:avoid}.subtitle{widows:2;padding-top:18pt;line-height:1.1500000000000001;orphans:2;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt;page-break-after:avoid}li{color:#000000;font-size:11pt;font-family:"Calibri"}p{color:#000000;font-size:11pt;margin:0;font-family:"Calibri"}h1{widows:2;padding-top:24pt;line-height:1.1500000000000001;orphans:2;text-align:left;color:#000000;font-size:24pt;font-family:"Calibri";font-weight:bold;padding-bottom:6pt;page-break-after:avoid}h2{widows:2;padding-top:18pt;line-height:1.1500000000000001;orphans:2;text-align:left;color:#000000;font-size:18pt;font-family:"Calibri";font-weight:bold;padding-bottom:4pt;page-break-after:avoid}h3{widows:2;padding-top:14pt;line-height:1.1500000000000001;orphans:2;text-align:left;color:#000000;font-size:14pt;font-family:"Calibri";font-weight:bold;padding-bottom:4pt;page-break-after:avoid}h4{widows:2;padding-top:12pt;line-height:1.1500000000000001;orphans:2;text-align:left;color:#000000;font-size:12pt;font-family:"Calibri";font-weight:bold;padding-bottom:2pt;page-break-after:avoid}h5{widows:2;padding-top:11pt;line-height:1.1500000000000001;orphans:2;text-align:left;color:#000000;font-size:11pt;font-family:"Calibri";font-weight:bold;padding-bottom:2pt;page-break-after:avoid}h6{widows:2;padding-top:10pt;line-height:1.1500000000000001;orphans:2;text-align:left;color:#000000;font-size:10pt;font-family:"Calibri";font-weight:bold;padding-bottom:2pt;page-break-after:avoid}</style></head><body class="c11"><p class="c4"><span class="c2">How to Set Up and Use Dynamics NAV Web Services</span></p><p class="c4"><span class="c0 c1">Version: 5/29/2014</span></p><p class="c3"><span></span></p><p class="c8"><span>While it&rsquo;s possible to connect to the native NAV database directly using OBDC, Dynamics NAV web services allow you to use expose existing codeunits and pages and then make use of the validation and C/AL code that these objects provide. &nbsp;Pages (and the tables they&rsquo;re based on) exposed as web services provide Create, Read, Update, Delete and filtering methods via a SOAP (Simple Object Access Protocol) endpoint. &nbsp;The WSDL (Web Service Definition Language) file exposed by the web service also can be imported into Visual Studio to assist in the creation of classes and methods that can be used to get data from the NAV database. &nbsp;Connecting to a web service is more difficult without using Visual Studio, because other languages (like PHP) don&rsquo;t natively support SOAP or WSDL. &nbsp;Because web services can be consumed by both internet and internal desktop-based applications, web services can be a good way to add custom functionality to Dynamics NAV without modifying NAV objects and code.</span></p><p class="c8"><span>In order to use web services, the &ldquo;Microsoft Dynamics NAV Business Web Services&rdquo; Windows Service must be running. &nbsp;This service can only connect to SQL server NAV databases, so in order to use web services, you must first upgrade a native database to a SQL database. &nbsp;Navision Classic forms and reports can still be used after the conversion to SQL by using the &ldquo;Classic Client for SQL Server&rdquo; executable instead of the Role-Tailored Client. &nbsp; </span></p><p class="c8"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 119.93px;"><img alt="" src="images/image00.png" style="width: 624.00px; height: 119.93px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c4"><span class="c2">Overview:</span></p><p class="c4"><span class="c5">Convert Native Navision Database to SQL Server Database:</span></p><p class="c4"><span class="c0">Step 1: Install SQL Server 2012<br>Step 2: Run migrate.fob codeunit (using classic client) to check for invalid dates</span></p><p class="c4"><span class="c0">Step 3: Install the components of NAV 2009 needed for web services</span></p><p class="c4"><span class="c0">Step 4: Create a backup of the database in the classic client, and restore it into the classic client w/ SQL</span></p><p class="c4"><span class="c0">Step 5: Recompile objects</span></p><p class="c4"><span class="c5">Publishing Web Services:</span></p><p class="c4"><span class="c0">Step 1: Edit CustomSettings.config to use the right database, and start the Windows service</span></p><p class="c4"><span class="c0">Step 2: Check that the service is running via web browser</span></p><p class="c4"><span class="c0">Step 3: Use the &ldquo;Web Services&rdquo; table to publish a Page or Codeunit</span></p><p class="c4"><span class="c5">Connecting to Web Services:</span></p><p class="c4"><span class="c0">Step 1: Add Service Reference in Visual Studio</span></p><p class="c4"><span class="c0">Step 2: Modify basicHttpBinding so that it can connect to NAV</span></p><p class="c8 c13"><span></span></p><p class="c8"><span class="c10">Convert Native Navision Database to SQL Server Database:</span></p><p class="c8"><span class="c1">Step 1: Install SQL Server 2012</span></p><p class="c4"><span class="c0">With the version of SQL Server Express included in NAV 2009, the maximum database size is 4 Gigabytes. &nbsp;Before proceeding with the upgrade, install a full version of SQL Server, or more recent version of SQL Server Express, which allows for databases up to 10 Gigabytes in size. &nbsp;</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0">The latest version of SQL server approved by Microsoft to work with NAV is SQL Server 2012.</span></p><p class="c4"><span class="c0">Evaluation can be downloaded at:</span></p><p class="c4"><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fdownload%2Fdetails.aspx%3Fid%3D29066&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFoV2HTkwWG4yI02jE_-K97PfgtMw">http://www.microsoft.com/en-us/download/details.aspx?id=29066</a></span></p><p class="c4"><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Ftechnet.microsoft.com%2Fen-us%2Fevalcenter%2Fhh225126.aspx&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGY6QLiZeyq_R1XcwgTRUbYBfdbvQ">http://technet.microsoft.com/en-us/evalcenter/hh225126.aspx</a></span></p><p class="c4"><span class="c0">(Second link is faster, but requires downloading a download client.)</span></p><p class="c4"><span class="c0">When installing, install the following components: &ldquo;Database Engine Services&rdquo;, &ldquo;Client Tools Connectivity&rdquo;, and &ldquo;Management Tools &ndash; Complete&rdquo;</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0">More information here: </span><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fdd568708.aspx&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNE7hFqjuDD-SgNgoyFnDCpKs33edg">http://msdn.microsoft.com/en-us/library/dd568708.aspx</a></span></p><p class="c4"><span class="c0">Additional configuration may be required if the NAV Server and Database Server are on different computers: </span><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fdd568739.aspx&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNH919n-BTze0QwsfrZtQKvMX4mojQ">http://msdn.microsoft.com/en-us/library/dd568739.aspx</a></span></p><p class="c3"><span><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fdd568739.aspx&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNH919n-BTze0QwsfrZtQKvMX4mojQ"></a></span></p><p class="c3"><span><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fdd568739.aspx&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNH919n-BTze0QwsfrZtQKvMX4mojQ"></a></span></p><p class="c4"><span class="c0 c1">Step 2: Run migrate.fob codeunit (using classic client) to check for invalid dates</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0">Before the NAV database can be backed up and restored into SQL, you need to check your database for fields that are invalid in SQL, or the import will fail. &nbsp;This check (and resulting fixes) can be performed using the migrate.fob codeunit contained in the &ldquo;Upgrade Toolkit&rdquo; folder on the NAV installation DVD. &nbsp;Note that running the migrate.fob codeunit requires use of a developer&rsquo;s license. &nbsp;Running the codeunit on our database with about 17,000,000 records took about 12 hours. &nbsp;An overview of how to use this codeunit can be found here:</span></p><p class="c4"><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fsaurav-nav.blogspot.com%2F2012%2F12%2Fnav-2013-upgrade-part-iv-sql-migration.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHFK7atHdFwlaf1GKlpkT4xa2vuDQ">http://saurav-nav.blogspot.com/2012/12/nav-2013-upgrade-part-iv-sql-migration.html</a></span></p><p class="c3"><span><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fsaurav-nav.blogspot.com%2F2012%2F12%2Fnav-2013-upgrade-part-iv-sql-migration.html&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHFK7atHdFwlaf1GKlpkT4xa2vuDQ"></a></span></p><p class="c4"><span class="c0">While running the codeunit on our database, the codeunit would stop running and exit when it checked a certain record and display the error &ldquo;Not a valid date.&rdquo;. &nbsp;We were able to work around this problem by running the codeunit in Debug mode, so that we could identify the record that was causing the problem, and manually delete it. &nbsp;This problem was possibly caused by data corruption. &nbsp; &nbsp;</span></p><p class="c3"><span></span></p><p class="c3"><span></span></p><p class="c4"><span class="c0 c1">Step 3: Install the components of NAV 2009 needed for web services</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0">Run setup.exe on the NAV install DVD and make sure the following components are installed: &ldquo;Server&rdquo;, &ldquo;SQL Server Option&rdquo;, &ldquo;Classic Client&rdquo;, and &ldquo;Database Server&rdquo;. &nbsp;</span></p><p class="c3"><span></span></p><p class="c3"><span></span></p><p class="c4"><span class="c0 c1">Step 4: Create a backup of the database in the classic client, and restore it into the classic client w/ SQL</span></p><p class="c3"><span class="c0 c1"></span></p><p class="c4"><span class="c0">In the classic client, create a backup of the database (Tools-&gt;Backup). &nbsp;Then run the Classic Client with SQL Server as Administrator, create a new database (File-&gt;Database-&gt;New), making note of the name you give it, and then restore the backup into this new database. &nbsp;(Tools-&gt;Restore.) &nbsp;You should have the same functionality as you had in the Classic client with the native database. &nbsp;</span></p><p class="c3"><span></span></p><p class="c3"><span></span></p><p class="c4"><span class="c0 c1">Step 5: Recompile objects</span></p><p class="c3"><span class="c0 c1"></span></p><p class="c4"><span class="c0">In the following steps, if you receive errors about NAV not being able to locate a certain object, you may need to recompile that object. </span></p><p class="c3"><span></span></p><p class="c4"><span class="c5">Publishing Web Services:</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0 c1">Step 1: Edit CustomSettings.config to use the right database, and start the Windows service</span></p><p class="c4"><span class="c0">By default, the NAV Business Web Services Windows service will either expose the Demo database as a web service, or nothing. &nbsp;In order to tell the Windows service to use our new SQL version of our NAV database, we edit the CustomSettings.config file, which is found at C:\Program Files (x86)\Microsoft Dynamics NAV\60\Service. &nbsp;To edit it, you will need to run notepad (or other text editor) as an administrator. &nbsp;Change the key below to contain the name of the database you just created:</span></p><p class="c3"><span></span></p><p class="c4"><span class="c12">&lt;add key=&rdquo;DatabaseName&rdquo; value=&rdquo;your-database-name-here&rdquo;&gt;&lt;/add&gt;</span></p><p class="c4"><span class="c0 c1"><br></span><span class="c0">Then stop and start both of the Dynamics NAV Windows services together. &nbsp;(&ldquo;Restart&rdquo; doesn&rsquo;t seem to work).</span></p><p class="c3"><span></span></p><p class="c3"><span></span></p><p class="c4"><span class="c0 c1">Step 2: Check that the service is running via web browser</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0">If you open </span><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Flocalhost%3A7047%2FDynamicsNAV%2FWS%2Fservices&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFMdhvTr2tQ02gPU9pkcdZiKWlaGw">http://localhost:7047/DynamicsNAV/WS/services</a></span><span class="c0">&nbsp;in your browsers, you should see an XML document showing the services published. &nbsp;</span><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Flocalhost%3A7047%2FDynamicsNAV%2FWS%2FSystemService&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEYW3fs7R2olJwITPg-ntosu_zfdw">http://localhost:7047/DynamicsNAV/WS/SystemService</a></span><span class="c0">&nbsp;can be used to find the different companies in the database. &nbsp;Other services will be located at URLs like </span><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Flocalhost%3A7047%2FDynamicsNAV%2FWS%2FPage%2FCustomer&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNF06bfeg0OB0iHPXXHxFy2oxBxr8Q">http://localhost:7047/DynamicsNAV/WS/Page/Customer</a></span><span class="c0">, but first you must publish these objects. &nbsp;</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0">The web services server is running (by default) on port 7047, while the server used by the Role-Tailored Client is running on port 7046.</span></p><p class="c3"><span></span></p><p class="c3"><span></span></p><p class="c4"><span class="c0 c1">Step 3: Use the &ldquo;Web Services&rdquo; table to publish a Page or Codeunit</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0">Web services can be published using the Classic client (for SQL), the Role Tailored Client is not required, as long as you have table 2000000076, &ldquo;Web Service&rdquo;. &nbsp;Run the table in Object Designer, and enter the Object Type and ID, and check the &ldquo;Published&rdquo; Box. &nbsp;The name you give the service is how it will be accessed via URL, NOT the name of the object being published. &nbsp;Pages can be easily created to expose certain fields of existing tables.</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0">The service should now be listed at </span><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Flocalhost%3A7047%2FDynamicsNAV%2FWS%2Fservices&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFMdhvTr2tQ02gPU9pkcdZiKWlaGw">http://localhost:7047/DynamicsNAV/WS/services</a></span><span class="c0">.</span></p><p class="c3"><span></span></p><p class="c4"><span class="c5">Connecting to Web Services:</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0 c1">Step 1: Add Service Reference in Visual Studio</span></p><p class="c3"><span></span></p><p class="c4"><span class="c0">Using the &ldquo;Add Service Reference&rdquo; functionality of Visual Studio loads the class names and function names from the WSDL provided by the web service endpoint, but it doesn&rsquo;t properly configure a httpBinding so it can connect to NAV. &nbsp;First, add the Service Reference (Project-&gt;Add Service Reference) as shown in the image below:</span></p><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 505.73px;"><img alt="" src="images/image01.png" style="width: 624.00px; height: 505.73px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c3"><span></span></p><p class="c4"><span class="c0">The Service Reference is now available in the &ldquo;Services Reference&rdquo; folder of you solution, and can be used with the </span><span class="c12">using &lt;project name&gt;.&lt;reference name&gt;; </span><span class="c0">directive. &nbsp;Take note of what you named the service reference.</span></p><p class="c3"><span class="c0"></span></p><p class="c4"><span class="c0 c1">Step 2: Modify basicHttpBinding so that it can connect to NAV</span></p><p class="c3"><span class="c0"></span></p><p class="c4"><span class="c0">The following C# code creates a client to NAV that can be used to perform Read, ReadMultiple, Create, Delete, etc functions. &nbsp;A separate client is created for each NAV service.</span></p><p class="c4"><span class="c0"><br>In this example, the name of the web service (created in NAV) is &ldquo;Item&rdquo;, and the name of the service reference (created in Visual Studio) is &ldquo;ItemReference&rdquo;.</span></p><p class="c3"><span class="c0"></span></p><p class="c4"><span class="c6">using &lt;project-name&gt;.ItemReference;</span></p><p class="c4"><span class="c6">BasicHttpBinding binding = new BasicHttpBinding();</span></p><p class="c4"><span class="c6">binding.Security.Mode = BasicHttpSecurityMode.TransportCredentialOnly;</span></p><p class="c4"><span class="c6">binding.Security.Transport.ClientCredentialType = HttpClientCredentialType.Windows; </span></p><p class="c4"><span class="c6">ItemReference.Item_PortClient client = new ItemReference.Item_PortClient(binding, new EndpointAddress(&quot;http://localhost:7047/DynamicsNAV/WS/&lt;your-escaped-company-name&gt;/Page/Item&quot;));</span></p><p class="c4"><span class="c6">client.ClientCredentials.Windows.AllowedImpersonationLevel = TokenImpersonationLevel.Delegation;</span></p><p class="c3"><span class="c0"></span></p><p class="c4"><span class="c0">Examples of how the client can be used:</span></p><p class="c4"><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fblogs.msdn.com%2Fb%2Ffreddyk%2Farchive%2F2010%2F01%2F20%2Fconnecting-to-nav-web-services-from-c-using-service-reference-code-version.aspx&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNE1G7BJUTNBmP34oh2OzMcLY9lRYA">http://blogs.msdn.com/b/freddyk/archive/2010/01/20/connecting-to-nav-web-services-from-c-using-service-reference-code-version.aspx</a></span><span class="c0">&nbsp; &nbsp; &nbsp;/ blog with demo c# application</span></p><p class="c4"><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fdd355316.aspx&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEKg1VkBbpxahDokVUaOb1bMSqW2A">http://msdn.microsoft.com/en-us/library/dd355316.aspx</a></span><span class="c0">&nbsp; &nbsp;/ walkthough with non-working code on how to create and use a page web service</span></p><p class="c4"><span class="c0 c9"><a class="c7" href="http://www.google.com/url?q=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fff477110.aspx&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNF3ANN8nDQd2aa4P7t8TFAw66nYjg">http://msdn.microsoft.com/en-us/library/ff477110.aspx</a></span><span class="c0">&nbsp; &nbsp;/ how to use the &ldquo;ReadMultiple&rdquo; operation</span></p></body></html>